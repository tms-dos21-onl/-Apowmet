1. Установить MySQL на VM.

<details><summary>Результат:</summary>
  
Установка:

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/2fe9d57c-7321-4f0c-a0ff-f0b3023a1134)

Проверка статуса:

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/bd56a09e-b2a1-476f-bb91-89972563c789)

</details>

2. (**) Настроить Multi-Primary репликацию для MySQL на 2 VM согласно инструкции.

3. Создать схему БД clinic и наполнить её данными используя скрипты из https://github.com/tms-dos21-onl/_sandbox/tree/main/lecture18/mysql/initdb.d/data.

<details><summary>Результат:</summary>
  
Вхожу в MySQL:

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/48f801a9-df3f-4941-b5cd-88d7c76e4cf1)

Создаю БД и проверяю (как потом увидел в скрипте уже было написано создание новый БД )) ):

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/62923465-ff6f-471d-afa7-a350c05e27ad)

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/7cacf40e-a221-4e16-a90e-b7643f9ccf36)

Следующие шаги делал, потому как предыдущие ДЗ еще не сделал))
Для скачивания репозитория создал SSH ключ для гита:

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/bf9917f7-3027-49fd-8570-9d6a6ca0372f)

Отсюда его забрал и добавил в свой профиль на гите:

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/f818e681-6c44-4ab1-a7cf-0d2ba82fd093)

Скачал репозиторий:

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/ce1d17fb-7887-42a7-9a4c-bdb4f5f99a7d)

Заполняю БД (также и со вторым файлом):

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/1eb3e762-a691-43f3-9848-58e8fb475173)

Проверка заполненности БД:

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/3d739b67-90ac-4b1f-bc88-05a86090c026)

</details>

4. Создать бэкап базы данных clinic.

<details><summary>Результат:</summary>
  
Данной командой создаю резервную копию своей БД, которая содержит SQL-запросы для восстановления БД:

![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/e3524e18-eaa7-492d-9288-229c77de9b8b)

Такой командой можно создать сразу архив: sudo mysqldump -u root -p clinic | gzip > $HOME/backup_clinic.sql.gz

</details>

5. Написать следующие SQL запросы:
- Вывести всех врачей, работающих в терапевтическом отделении.
- Вывести в каких отделениях побывал каждый пациент.
- Обновить дату приёма для пациента Ивана Иванова на 2022-02-09.
- Удалить врача Андрея Быкова и все его приёмы.
- Добавить нового врача Фила Ричардса и новую пациентку Василису Васильеву и записать её к Филу Ричардсу на приём на 2022-02-14.

<details><summary>Запрос для показа всех врачей из терапевтического отделения:</summary>
  
```
SELECT doc.FirstName, doc.LastName, d.Name, j.Title
FROM Job AS j 
JOIN Department AS d 
ON j.Department_id = d.id
JOIN Doctor AS doc
ON j.Doctor_id = doc.id
WHERE d.Name = 'Терапевтический';
```
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/320544f8-bbdd-4e34-bc16-f2ed9f056e37)
  
</details>

<details><summary>Отделения, где побывал каждый пациент:</summary>

```
SELECT p.FirstName, p.LastName, d.Name, r.Number
FROM Appointment AS a
JOIN Patient AS p
ON a.Patient_id = p.id
JOIN Room AS r
ON a.Room_id = r.id
JOIN Department AS d
ON r.Department_id = d.id;
```
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/26f98dd9-6091-4371-bb03-5f1be444a5ea)

</details>

<details><summary>Запрос на обновление даты приема:</summary>
  
```
UPDATE Appointment
SET Date = '2022-02-09'
WHERE Patient_id = (
SELECT id
FROM Patient
WHERE FirstName = 'Иван'
AND LastName = 'Иванов'
);
```
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/b45172e1-099c-499c-bf90-ef76552f26a2)
  
</details>

<details><summary>Запрос на удаление врача и его приемов (тут я использовал 2 способа):</summary>

- первый это удалить данные из таблицы, которые ссылаются на родительскую по Foreign Key, в данном случае Doctor_id
```
DELETE a FROM Appointment AS a
JOIN Doctor AS d ON a.Doctor_id = d.id
WHERE d.FirstName = 'Андрей' 
AND d.LastName = 'Быков';
```
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/27fe0280-8a8a-443e-99ac-9f4ccfeb4b12)
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/fd0ee2f2-1356-4070-9bf3-585a0dd9abbe)

Но дальнейший шаг не будет выполнен, потому как есть еще 1 связь:
```
DELETE a FROM Appointment AS a
JOIN Doctor AS d ON a.Doctor_id = d.id
WHERE d.FirstName = 'Андрей' 
AND d.LastName = 'Быков';
```
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/064b26cf-f14a-4ca8-bc1a-56f49a6bf679)

- тут уже использую второй способ каскадным удалением (удаляются данные зависимые от родительских):
```
ALTER TABLE Job DROP FOREIGN KEY Doctor_id;
ALTER TABLE Job ADD CONSTRAINT Doctor_id FOREIGN KEY (Doctor_id) REFERENCES Doctor(id) ON DELETE CASCADE;
```
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/00de0ccd-e75d-4900-8f38-94922a6dcfa1)
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/2989688d-3564-4fd7-8104-8ab64f0c42dd)
P.S. Отдельно команды удалить не получалось, как понимаю из-за того, что, при создании таблицы, к внешнему ключу по-умолчанию применяется свойство целосности "ON DELETE RESTRICT"

</details>

<details><summary>Запрос на добавление врача, пациента и записи на прием:</summary>

Так как при создании таблиц были заданы св-ва NOT NULL, мне тоже нужно указать все данные:
```
INSERT INTO Doctor (id, FirstName, LastName, BirthDate, Telephone, Email)
VALUES (7, 'Фил', 'Ричардс', '2000-01-01', '+37533XXXXXXX', 'phil.richards@clinic.com');
```
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/cd497f9d-efa2-4006-9c88-99ec2d743b3c)
```
INSERT INTO Patient (id, FirstName, LastName, BirthDate, Address, Telephone, Email)
VALUES (6, 'Василиса', 'Васильева', '2010-12-31', 'Атлантида', '+37525XXXXXXX', 'vasilisa.vasilieva@example.com');
```
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/c8f023c9-9f8c-46cd-9c2f-23bf73d35781)

```
INSERT INTO Appointment (id, Patient_id, Doctor_id, Date, Room_id)
VALUES (
6,
(SELECT id FROM Patient WHERE Patient.FirstName = 'Василиса' AND Patient.LastName = 'Васильева'),
(SELECT id FROM Doctor WHERE Doctor.FirstName = 'Фил' AND Doctor.LastName = 'Ричардс'),
'2022-02-14',
'5'
);
```
![image](https://github.com/tms-dos21-onl/aleksey-ivanishchev/assets/93286236/57e94515-e089-4809-bf11-95c5b29ecd01)

</details>

6. Восстановить базу данных clinic из бэкапа и проверить, что данные соответствуют состоянию базы данных до внесенных в предыдущем задании изменений.

7. Установить MongoDB

8. Создать БД clinic и наполнить её данными используя скрипты из https://github.com/tms-dos21-onl/_sandbox/tree/main/lecture18/mongo/initdb.d.

9. Написать выборочно 3 запроса из задания 5 для MongoDB используя mongosh команды.
